# 垃圾回收

垃圾回收是针对堆内存，堆外内存是间接受到垃圾回收机制的管控，如直接内存（堆内存维护了堆外内存数据的引用）

![image-20210225162822649](https://tva1.sinaimg.cn/large/008eGmZEly1gnzv0uja1lj30pg052ju6.jpg)

可达性分析算法

![image-20210225183100310](https://tva1.sinaimg.cn/large/008eGmZEly1gnzykeosfmj316e0rake5.jpg)



强引用，内存会溢出

![image-20210225183716888](https://tva1.sinaimg.cn/large/008eGmZEly1gnzyqxiqeqj30x40i8n30.jpg)



软引用。不重要的数据可以用软引用

![image-20210225183823790](https://tva1.sinaimg.cn/large/008eGmZEly1gnzys3ruefj30t00eajy0.jpg)



List里很多元素都是null，其实里面存的是软引用对象，只不过软引用的对象是null。通过引用队列

![image-20210225184839850](https://tva1.sinaimg.cn/large/008eGmZEly1gnzz2rody0j30wc0nigxv.jpg)



弱引用

![image-20210225185243432](https://tva1.sinaimg.cn/large/008eGmZEly1gnzz6zr61rj31ak02saax.jpg)

![image-20210225185127693](https://tva1.sinaimg.cn/large/008eGmZEly1gnzz5p3tl0j30ts0k2aih.jpg)



## 垃圾回收算法

标记清除。清除不是真的清0，而是做一个记录，下次分配的时候从记录里去找一个可用的内存

效率高，但是缺点就是容易产生碎片，对于数组对象不友好。

![image-20210225190132959](https://tva1.sinaimg.cn/large/008eGmZEly1gnzzg7eztjj30oq0hkjvp.jpg)

标记整理。移动存活对象，使对象之间更紧凑

优点：没有碎片，缺点：移动影响效率，而且还要修改对象的引用

![image-20210225190237536](https://tva1.sinaimg.cn/large/008eGmZEly1gnzzhb7fxyj314g0hyag7.jpg)

复制。复制完成之后From变成To，To变成From。To总是一个空闲的空间

占用双倍的内存空间

![image-20210225190917729](https://tva1.sinaimg.cn/large/008eGmZEly1gnzzo8np6fj30yy0cu78s.jpg)



JVM并不是单独使用某一回收算法，而是三种算法协同工作

## 分代垃圾回收机制

https://www.bilibili.com/video/BV1yE411Z7AP?p=62&spm_id_from=pageDriver

长时间使用的对象放在老年代中

老年代里的对象很久发生一次垃圾回收

根据对象的生命周期做处理



![image-20210225192034402](https://tva1.sinaimg.cn/large/008eGmZEly1gnzzzz6c77j3108046n0r.jpg)



minor GC是开启新生代垃圾回收

full GC是开启一次新生代和老年代的垃圾回收

![image-20210225193534856](https://tva1.sinaimg.cn/large/008eGmZEly1go00flla4aj311i0qazzl.jpg)



![image-20210225193608546](https://tva1.sinaimg.cn/large/008eGmZEly1go00g6ki56j31140l4tjt.jpg)



![image-20210225194256636](https://tva1.sinaimg.cn/large/008eGmZEly1go00n9kwpvj315c0l4ava.jpg)





## 垃圾回收器

![image-20210225200350426](https://tva1.sinaimg.cn/large/008eGmZEly1go01907z0fj30wg0csgr1.jpg)

CMS

G1