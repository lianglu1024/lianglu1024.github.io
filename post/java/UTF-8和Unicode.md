# UTF-8和Unicode

- Unicode 是字符集，对字符集数字化
- UTF-8（Unicode Transfer Format） 是编码规则，为更好的存储和传输

Unicode 只是一个符号集，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。

比如，汉字"严"的 Unicode 是十六进制数`4E25`，转换成二进制数足足有15位（`100111000100101`），也就是说，这个符号的表示至少需要2个字节。表示其他更大的符号，可能需要3个字节或者4个字节，甚至更多。

这里就有两个严重的问题，第一个问题是，如何才能区别 Unicode 和 ASCII ？计算机怎么知道三个字节表示一个符号，而不是分别表示三个符号呢？第二个问题是，我们已经知道，英文字母只用一个字节表示就够了，如果 Unicode 统一规定，每个符号用三个或四个字节表示，那么每个英文字母前都必然有二到三个字节是0，这对于存储来说是极大的浪费，文本文件的大小会因此大出二三倍，这是无法接受的。

它们造成的结果是：1）出现了 Unicode 的多种存储方式，也就是说有许多种不同的二进制格式，可以用来表示 Unicode。2）Unicode 在很长一段时间内无法推广，直到互联网的出现。

UTF-8 就是在互联网上使用最广的一种 Unicode 的实现方式。其他实现方式还包括 UTF-16（字符用两个字节或四个字节表示）和 UTF-32（字符用四个字节表示），不过在互联网上基本不用。**重复一遍，这里的关系是，UTF-8 是 Unicode 的实现方式之一。**

UTF-8 最大的一个特点，就是它是一种变长的编码方式。它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。

## 测试

我们在mac下新建一个test.txt，输入“中国abc”，保存发现文本大小9个字节。两个汉字各占用3个字节，字母占用1个字节

```python
In [11]: f = open("test.txt","rb")

In [12]: f.read()
Out[12]: b'\xe4\xb8\xad\xe5\x9b\xbdabc'  # 存在硬盘上的真实模样，二进制
  
In [15]: b'\xe4\xb8\xad\xe5\x9b\xbdabc'.decode("utf-8")
Out[15]: '中国abc'
```

**那这9个字节是如何解码成“中国abc”呢？**

我们先将这9个字节转成二进制

```
11100100 10111000 10101101 11100101 10011011 10111101 01100001 01100010 01100011
```

当我们使用utf8进行解码的时候，会按照下面的逻辑定位几个字节占用一个字符

```
Unicode符号范围     |        UTF-8编码方式
(十六进制)          |          （二进制）
----------------------+---------------------------------------------
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
```

这样子我们看到三个字节占用一个字符，脱去校验位，剩下的0100111000101101对应的是4E2D，正好就是汉字"中"，以此类推，解析出"国"。

## 字符和字节

字节是用8个bit表示一个字节

字符是人类使用的符号，比如"中"是一个字符（尽管存储的时候占用了3个字节），"a"是一个字符

## 参考

[字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)

[学点编码知识又不会死：Unicode的流言终结者和编码大揭秘 ](https://www.freebuf.com/articles/others-articles/25623.html)