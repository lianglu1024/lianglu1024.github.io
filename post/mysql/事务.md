# 事务

一个事务就是一个或多个数据库操作的集合，默认情况下事务是自动提交的，也就是说当我们执行一条SQL的时候，例如下面的一条update语句，这条SQL就在一个事务里。

```
update account set balance=balance-10000 where name="A";
```

那么在事务里和没有事务有啥区别呢？比如没有事务的情况下，在执行了这条update之后突然断电，那么这条数据是可能没有刷新到磁盘上的，因为数据的修改是在内存里，一段时间后才会被flush到磁盘上。因此一个事务必须要满足持久性，即事务提交之后数据持久化到磁盘。

数据库事务的ACID四大特性：

* 原子性(A)：事务是最小单位，不可再分。事务里的操作要么全部执行成功，要么不执行
* 一致性(C)：事务要求所有的DML语句操作的时候，必须保证同时成功或者同时失败
* 隔离性(I)：事务A和事务B之间具有隔离性
* 持久性(D)：是事务的保证，事务终结的标志(内存的数据持久到硬盘文件中)

手动提交事务的方式：

```
start transaction [read only]
sql1...
sql2...
commit
```

接下来就是通过何种手动来满足上面的四大特性了？

## 持久性

我们在提交了事务之后并不能够立刻将内存中修改的数据刷新到磁盘上，这是因为：

* 如果只是修改了某个页里的某一个字节，那么刷新一个完整的数据也太浪费了
* 如果一个事务里修改了很多条数据，而且这些数据分布在不同的页里，那么随机IO刷起来特别慢

聪明的你可能想到了用追加日志的方式，优点显而易见，占用空间小，日志是顺序写入磁盘的。

## 日志



## 隔离级别



## 参考
* [MySQL深入理解事务的来龙去脉](https://juejin.im/post/5cbc049de51d456e7b372089)
* [详细分析MySQL事务日志(redo log和undo log)](https://juejin.im/entry/5ba0a254e51d450e735e4a1f)
* [『浅入深出』MySQL 中事务的实现](https://draveness.me/mysql-transaction/)
* [深入学习MySQL事务：ACID特性的实现原理](https://www.cnblogs.com/kismetv/p/10331633.html)
